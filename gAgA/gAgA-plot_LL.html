<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../es5/tex-mml-chtml.js" async></script>
</head>
<body>
    <h1>Line Chart from Multiple Datasets</h1>
    <canvas id="myChart" width="800" height="400"></canvas>
    
    <script>
        // List of CSV files and their labels
        const datasetsInfo = [
            { file: './lepton-lepton/2Almasi2020_m_abs_ee.csv', label: 'Almasi 2020', borderColor: 'blue' },
            { file: './lepton-lepton/2Ficek_2017_V2_m_abs_ee.csv', label: 'Ficek 2017', borderColor: 'red' },
            { file: './lepton-lepton/2Heckel_2013_m_abs_ee.csv', label: 'Heckel 2013', borderColor: 'green' }
        ];

        // Initialize the chart
        const ctx = document.getElementById('myChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // Will be updated dynamically
                datasets: [] // Empty initially
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'X-axis'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Y-axis'
                        }
                    }
                }
            }
        });

        // Function to fetch and process a single CSV file
        function fetchAndAddDataset(datasetInfo) {
            fetch(datasetInfo.file)
                .then(response => response.text())
                .then(csvText => {
                    const rows = csvText.trim().split('\n');
                    const xData = rows.map(row => row.split(',')[0]); // First column as x-axis
                    const yData = rows.map(row => parseFloat(row.split(',')[1])); // Second column as y-axis

                    // Add the dataset to the chart
                    chart.data.datasets.push({
                        label: datasetInfo.label,
                        data: yData,
                        borderColor: datasetInfo.borderColor,
                        borderWidth: 2,
                        fill: false
                    });

                    // Update labels (x-axis data) if not already set
                    if (chart.data.labels.length === 0) {
                        chart.data.labels = xData;
                    }

                    // Update the chart
                    chart.update();
                })
                .catch(error => console.error(`Error loading ${datasetInfo.file}:`, error));
        }

        // Fetch and add all datasets
        datasetsInfo.forEach(fetchAndAddDataset);
    </script>
</body>
</html>