<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <h1>Log-Log Plot for <span id="math-title"></span></h1>
    <canvas id="myChart" width="800" height="400"></canvas>
    <div style="text-align: center;">
        <p><span id="math-x-axis"></span></p>
    </div>

    <script>
        // Initialize MathJax expressions for titles
        document.getElementById('math-title').innerHTML = '\\(g_Ag_A\\)';
        document.getElementById('math-x-axis').innerHTML = '\\(\\lambda \\text{ (m)}\\)';
        MathJax.typeset();

        // List of CSV files and their custom labels
        const datasetsInfo = [
            { file: './lepton-lepton/2Almasi2020_m_abs_ee.csv', label: 'Almasi 2020' },
            { file: './lepton-lepton/2Ficek_2017_V2_m_abs_ee.csv', label: 'Ficek 2017' },
            { file: './lepton-lepton/2Heckel_2013_m_abs_ee.csv', label: 'Heckel 2013' }
        ];

        // Chart initialization
        const ctx = document.getElementById('myChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } },
                scales: {
                    x: { type: 'logarithmic', title: { display: true, text: 'λ (m)' }, ticks: { callback: (value) => value.toExponential() } },
                    y: { type: 'logarithmic', title: { display: true, text: 'g_Ag_A' }, ticks: { callback: (value) => value.toExponential() } }
                }
            }
        });

        // Function to fetch and process a single CSV file
        function processCsvFile(filePath) {
            return fetch(filePath)
                .then(response => response.text())
                .then(csvText => {
                    const rows = csvText.trim().split('\n'); // Split rows
                    if (rows.length === 0) throw new Error(`File ${filePath} is empty or invalid.`);
                    
                    const xData = rows.map(row => parseFloat(row.split(',')[0])); // First column: λ
                    const yData = rows.map(row => parseFloat(row.split(',')[1])); // Second column: gAgA
                    
                    // Validate data to ensure it's numerical and valid
                    if (xData.some(isNaN) || yData.some(isNaN)) {
                        throw new Error(`File ${filePath} contains invalid numerical data.`);
                    }
                    
                    return { xData, yData }; // Return parsed x and y data
                });
        }

        // Load all datasets and update the chart
        Promise.all(datasetsInfo.map(dataset =>
            processCsvFile(dataset.file).then(({ xData, yData }) => ({
                xData, yData, label: dataset.label
            }))
        )).then(datasets => {
            datasets.forEach(({ xData, yData, label }) => {
                chart.data.datasets.push({
                    label: label, // Custom label
                    data: xData.map((x, i) => ({ x: x, y: yData[i] })), // Combine x and y into {x, y}
                    borderColor: `#${Math.floor(Math.random() * 16777215).toString(16)}`, // Random color
                    borderWidth: 2,
                    fill: false
                });
            });
            chart.update();
        }).catch(error => console.error('Error loading datasets:', error));
    </script>
</body>
</html>